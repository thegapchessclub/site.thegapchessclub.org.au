#!/bin/sh

EXE=./dist-newstyle/site # ../result/bin/site

git fetch origin master
git merge
(cd content; cabal new-build) # nix-build release.nix -A generator
(cd generator; $EXE clean)
mkdir -p content/_site
git clone -n git@github.thegapchessclub.org.au:thegapchessclub/www.thegapchessclub.org.au.git content/_site
(cd generator; $EXE build)
(cd content/_site; git config user.email "admin@thegapchessclub.org.au")
(cd content/_site; git config user.name "thegapchessclub.org.au publisher")
(cd content/_site; git add .)
(cd content/_site; git commit -m "publish")
(cd content/_site; git push origin master)
(cd generator; $EXE clean)
